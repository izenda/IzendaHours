<div id="VIS_ID_CONTAINER">
	<div id="VIS_ID_HOLDER">
		<div id="VIS_ID"></div>
	</div>
</div>

<script type="text/javascript">
	(function(H) {
		var addEvent = H.addEvent;

		H.wrap(H.Chart.prototype, 'init', function(proceed) {
			proceed.apply(this, Array.prototype.slice.call(arguments, 1));

			var chart = this,
				legend = chart.legend,
				options = chart.legend.options,
				isDragging,
				downX, downY,
				optionsX, optionsY,
				currentX, currentY;

			if (!options.draggable)
				return;

			legend.box.css({ cursor: 'move' });

			addEvent(legend.box.element, 'mousedown', function(e) {
				e = chart.pointer.normalize(e);
				downX = e.chartX;
				downY = e.chartY;
				optionsX = options.x;
				optionsY = options.y;
				currentX = legend.group.attr('translateX');
				currentY = legend.group.attr('translateY');
				isDragging = true;
			});
			addEvent(chart.container, 'mousemove', function(e) {
				if (!isDragging)
					return;

				e = chart.pointer.normalize(e);
				var draggedX = e.chartX - downX,
				    draggedY = e.chartY - downY;

				options.x = optionsX + draggedX;
				options.y = optionsY + draggedY;

				if (chart.pointer.selectionMarker)
					chart.pointer.selectionMarker = chart.pointer.selectionMarker.destroy();
			});

			addEvent(document, 'mouseup', function() {
				isDragging = false;
			});
		});
	}(Highcharts));
	(function ExecuteVIS_ID() {
		var VIS_EMBEDDED_DATA;

		var width = 720, height = 500;

		var util = window.ReportScripting, vis,
			isThumbnails = (document.URL === 'about:blank');

		function getItem(list, index) {
			return list[index % list.length];
		}

		try {
			if (typeof window.jq$ == "undefined") {
				window.jq$ = jQuery.noConflict(true);
			}

			if (jq$("#VIS_ID").size() < 1) {
				util.unregisterResize("VIS_ID");
				return;
			}

			if (!util.validate("VIS_ID", VIS_FORMJSASTATUS, VIS_CONTEXT)) {
				return;
			}

			(function () {
				var fieldCount = VIS_COLUMNS.length;
				var testCondition = fieldCount > 1
					&& jq$.grep(VIS_COLUMNS.slice(1), function (o) { return !util.isMetric(o); }).length == 0;
				if (!testCondition) {
					throw new izenda.error.ChartSetUpError(VIS_CONTEXT.resources.chartsetupincorrectly);
				}
			})();

			var colors = ['#2f7ed8', '#8bbc21', '#0d233a', '#910000', '#1aadce', '#492970', '#f28f43', '#77a1e5', '#c42525', '#a6c96a'];

			vis = new util("VIS_ID", VIS_FORMJSASTATUS, VIS_COLUMNS, VIS_ROWS, VIS_CONTEXT);

			var rows = vis.getRows(true),
				columns = util.exchangeAxes(rows),
				items = vis.getItems();

			width = vis.getWidth();
			height = vis.getHeight();

			jq$('#VIS_ID').width(width).height(height);

			jq$('#VIS_ID_INSUFFICIENT_WIDTH_MESSAGE').remove();

			function showInsufficientWidth(width, height) {
				var insufficientWidthMessage = '<div id="VIS_ID_INSUFFICIENT_WIDTH_MESSAGE" style="width: ' + (width - 20) + 'px; height: ' + (height - 20) + 'px; text-align: center; font-size: 16px; padding: 10px;"><span style="position: relative; top: 45%;">Insufficient Width</span></div>';
				jq$('#VIS_ID').html(insufficientWidthMessage);
			}

			function checkInsufficientWidth(width, count) {
				return (width < 240 || width < count * 30);
			}

			var itemsOnScreen = (columns.length < 3) ? rows.length : rows.length * 2,
				isInsufficientWidth = checkInsufficientWidth(width, itemsOnScreen),
				isImageRender = VIS_CONTEXT.toImage || VIS_CONTEXT.toStatic || isThumbnails;

			if (isInsufficientWidth && !isImageRender) {
				showInsufficientWidth(width, height);
				util.registerResize("VIS_ID", ExecuteVIS_ID, function () {
					var highchart = jq$('#VIS_ID').highcharts();
					if (highchart) {
						highchart.destroy();
					}
					jq$("#VIS_ID").empty();
				});
				return;
			}

			var yaxis = [], series = [];
			for (var i = 1; i < VIS_COLUMNS.length; i++) {
				yaxis.push({
					labels: { style: { color: getItem(colors, i-1) } },
					title: {
						text: null,
						style: { color: getItem(colors, i-1) }
					},
					opposite: i % 2 == 1
				});
				series.push({
					name: VIS_COLUMNS[i].name,
					type: i <= Math.ceil(VIS_COLUMNS.length / 3) ? 'column' : 'spline',
					color: getItem(colors, i-1),
					yAxis: i - 1,
					data: columns[i]
				});
			}

			jq$('#VIS_ID').highcharts({
				//chart: { zoomType: 'xy' },
				title: { text: VIS_CONTEXT.title },
				xAxis: [{ categories: columns[0] }],
				yAxis: yaxis,
				legend: {
					enabled: true
				},
				series: series,
				credits: { enabled: false },
				tooltip: {
					shared: true,
					formatter: function () {
						var html = [];
						html.push('<span style="font-size: 10px;">' + this.x + '</span>');
						jq$.each(this.points, function (i, point) {
							var fieldFormatter = VIS_COLUMNS.find(function (d) { return d.name == point.series.name; }).formatter;
							html.push('<span style="color:' + point.series.color + ';">\u25CF</span> ' + point.series.name + ': <b>' + (fieldFormatter ? fieldFormatter(point.y, items[point.point.index], vis, point.series.name) : point.y) + '</b>');
					});
						return html.join("<br/>");
					}
				}
			});

			util.registerResize("VIS_ID", ExecuteVIS_ID, function () {
				var highchart = jq$('#VIS_ID').highcharts();
				if (highchart) {
					highchart.destroy();
				}
				jq$("#VIS_ID").empty();
			});
		} catch (e) {
			util.logger.error(e);
			util.showVisualizationErrorMessage('VIS_ID', VIS_CONTEXT, e);
		}
	})();
</script>